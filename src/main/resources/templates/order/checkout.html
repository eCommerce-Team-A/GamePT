<html layout:decorate="~{layout}">
<div layout:fragment="content" class="mb-3">
    <div style="display: flex; justify-content: center; margin-top: 150px;">
        <h4 class="Nanum" th:text="결제금액"></h4>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1"
                   onchange="selectAmount(this)" value="5000">
            <label class="form-check-label" for="flexRadioDefault1">
                5,000
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2"
                   onchange="selectAmount(this)" value="10000">
            <label class="form-check-label" for="flexRadioDefault2">
                10,000
            </label>
        </div>
    </div>
    <!-- 주문서 영역 -->
    <div id="hiddenDiv" class="wrapper" style="display: none;">
        <div class="box_section"
             style="padding: 40px 30px 50px 30px;
          margin-top: 30px;
          margin-bottom: 50px;">
            <!-- 결제 UI -->
            <div id="payment-method"></div>
            <!-- 이용약관 UI -->
            <div id="agreement"></div>
            <!-- 쿠폰 체크박스 -->
            <div style="padding-left: 25px">
                <div class="checkable typography--p">
                    <label for="coupon-box" class="checkable__label typography--regular"
                    ><input
                            id="coupon-box"
                            class="checkable__input"
                            type="checkbox"
                            aria-checked="true"
                    /><span class="checkable__label-text"
                    >5,000원 쿠폰 적용</span
                    ></label
                    >
                </div>
            </div>
            <!-- 결제하기 버튼 -->
            <div class="result wrapper">
                <button class="button" id="payment-button" style="margin-top: 30px">
                    결제하기
                </button>
            </div>
        </div>
    </div>
    <script>
        const button = document.getElementById("payment-button");
        const coupon = document.getElementById("coupon-box");
        const generateRandomString = () =>
            window.btoa(Math.random()).slice(0, 20);
        let amount;

        function selectAmount(radioButton) {
            amount = radioButton.value;
            const hiddenDiv = document.getElementById('hiddenDiv');
            console.log(amount);
            if (amount !== null) {
                hiddenDiv.style.display = 'block'; // div 표시
            } else {
                hiddenDiv.style.display = 'none'; // div 숨김
            }
        }



        // ------  결제위젯 초기화 ------
        // TODO: clientKey는 개발자센터의 결제위젯 연동 키 > 클라이언트 키로 바꾸세요.
        // TODO: 구매자의 고유 아이디를 불러와서 customerKey로 설정하세요. 이메일・전화번호와 같이 유추가 가능한 값은 안전하지 않습니다.
        // @docs https://docs.tosspayments.com/reference/widget-sdk#sdk-설치-및-초기화
        const widgetClientKey = "test_ck_AQ92ymxN342JP6xMBgAOrajRKXvd";
        const customerKey = generateRandomString();
        const paymentWidget = PaymentWidget(widgetClientKey, customerKey); // 회원 결제
        // const paymentWidget = PaymentWidget(widgetClientKey, PaymentWidget.ANONYMOUS); // 비회원 결제

        // ------  결제 UI 렌더링 ------
        // @docs https://docs.tosspayments.com/reference/widget-sdk#renderpaymentmethods선택자-결제-금액-옵션
        paymentMethodWidget = paymentWidget.renderPaymentMethods(
            "#payment-method",
            {value: amount},
            // 렌더링하고 싶은 결제 UI의 variantKey
            // 결제 수단 및 스타일이 다른 멀티 UI를 직접 만들고 싶다면 계약이 필요해요.
            // @docs https://docs.tosspayments.com/guides/payment-widget/admin#멀티-결제-ui
            {variantKey: "DEFAULT"}
        );
        // ------  이용약관 UI 렌더링 ------
        // @docs https://docs.tosspayments.com/reference/widget-sdk#renderagreement선택자-옵션
        paymentWidget.renderAgreement("#agreement", {variantKey: "AGREEMENT"});

        // ------  결제 금액 업데이트 ------
        // @docs https://docs.tosspayments.com/reference/widget-sdk#updateamount결제-금액
        coupon.addEventListener("change", function () {
            if (coupon.checked) {
                paymentMethodWidget.updateAmount(amount - 5000);
            } else {
                paymentMethodWidget.updateAmount(amount);
            }
        });

        // ------ '결제하기' 버튼 누르면 결제창 띄우기 ------
        // @docs https://docs.tosspayments.com/reference/widget-sdk#requestpayment결제-정보
        button.addEventListener("click", function () {
            // 결제를 요청하기 전에 orderId, amount를 서버에 저장하세요.
            // 결제 과정에서 악의적으로 결제 금액이 바뀌는 것을 확인하는 용도입니다.
            paymentWidget.requestPayment({
                orderId: generateRandomString(),
                orderName: "토스 티셔츠 외 2건",
                successUrl: window.location.origin + "/success",
                failUrl: window.location.origin + "/fail",
                customerEmail: "customer123@gmail.com",
                customerName: "김토스",
                customerMobilePhone: "01012341234",
            });
        });
    </script>
</div>
</html>
