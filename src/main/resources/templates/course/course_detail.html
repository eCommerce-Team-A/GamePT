<html layout:decorate="~{layout}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
<div layout:fragment="content" class="mb-3">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <!-- Single Page Header start -->
    <div class="container-fluid page-header py-5">
        <h1 class="text-center text-white display-6">강의 상세</h1>
        <ol class="breadcrumb justify-content-center mb-0">
            <li class="breadcrumb-item active text-white">홈</li>
            <li class="breadcrumb-item active text-white">강의 목록</li>
            <li class="breadcrumb-item active text-white">강의 상세</li>
        </ol>
    </div>
    <!-- Single Page Header End -->


    <!-- Single Product Start -->
    <div class="container-fluid mt-3">
        <div class="container pt-5">
            <div class="d-flex align-items-center justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <h2 class="fw-bold" th:text="${course.name}"></h2>
                    <div class="badge rounded-pill text-bg-primary ms-2">[[${course.gameCategoryname}]]</div>
                </div>
                <div class="d-flex align-items-center">
                    <a class="btn btn-primary" th:href="@{/course/list}" role="button">강의 목록</a>
                </div>
            </div>

            <div class="row g-5 mb-5">

                <div class="col-lg-8 col-xl-9">

                    <div class="row">

                        <div class="card p-0 border-0 shadow">
                            <nav>
                                <div class="nav nav-tabs" style="display:flex;justify-content: space-around;">
                                    <button class="nav-link active border-white border-bottom-0" style="width:33%;"
                                            type="button"
                                            role="tab"
                                            id="nav-introduce-tab" data-bs-toggle="tab" data-bs-target="#nav-introduce"
                                            aria-controls="nav-about" aria-selected="true">강의 소개
                                    </button>
                                    <button class="nav-link border-white border-bottom-0" style="width:33%;"
                                            type="button" role="tab"
                                            id="nav-curriculum-tab" data-bs-toggle="tab"
                                            data-bs-target="#nav-curriculum"
                                            aria-controls="nav-mission" aria-selected="false">강의 커리큘럼
                                    </button>
                                    <button class="nav-link border-white border-bottom-0" style="width:33%;"
                                            type="button" role="tab"
                                            id="nav-review-tab" data-bs-toggle="tab" data-bs-target="#nav-review"
                                            aria-controls="nav-mission" aria-selected="false">강의 리뷰
                                    </button>

                                </div>
                            </nav>
                            <div class="tab-content mb-5 p-4">
                                <div class="tab-pane active" id="nav-introduce" role="tabpanel"
                                     aria-labelledby="nav-introduce-tab" th:text="${course.introduce}">
                                </div>
                                <div class="tab-pane" id="nav-curriculum" role="tabpanel"
                                     aria-labelledby="nav-curriculum-tab" th:text="${course.curriculum}">
                                </div>
                                <div class="tab-pane" id="nav-review" role="tabpanel"
                                     aria-labelledby="nav-review-tab">
                                        <h4 class="fw-bold">리뷰 작성하기</h4>
                                        <div class="row g-1">
                                            <div class="col-lg-12">
                                                <div class="rating">
                                                    <i id="i" class="rating__star far fa-star"></i>
                                                    <i class="rating__star far fa-star"></i>
                                                    <i class="rating__star far fa-star"></i>
                                                    <i class="rating__star far fa-star"></i>
                                                    <i class="rating__star far fa-star"></i>
                                                </div>
                                                <div class="border-bottom rounded mt-4 mb-2">
                                                    <textarea name="reviewContent" id="reviewContent"
                                                              class="form-control" cols="30" rows="4"
                                                              style="resize:none"
                                                              placeholder="리뷰 내용을 작성해주세요. *"
                                                              spellcheck="false"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="d-flex justify-content-end py-1">
                                                    <button id="postReview"
                                                            class="btn border border-secondary text-primary rounded-pill px-3 py-2">
                                                        작성 완료
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    <hr>

                                    <div th:each="review : ${reviewList}" id="reviews" class="d-flex">
                                        <div>
                                            <p class="mb-2" style="font-size: 14px;"></p>
                                            <div class="d-flex justify-content-between">
                                                <h5 th:text="@{|작성자 : ${review.author.username}|}"></h5>
                                            </div>
                                            <p th:text="${review.content}"></p>
                                        </div>
                                        <hr>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4 col-xl-3 p-0">
                    <div class="card border-0 shadow col-lg-12">
                        <div class="my-2 fw-bold" style="display:flex; justify-content:center; font-size:18px;">
                            담당 전문가님 이력
                        </div>
                        <hr class="w-100 m-0">
                        <div class="m-2">
                            <div>1번째 줄</div>
                            <div>2번째 줄</div>
                            <div>3번째 줄</div>
                            <div>4번째 줄</div>
                            <div>5번째 줄</div>
                        </div>
                    </div>
                    <div class="card border-0 shadow mt-3 col-lg-12">
                        <div class="my-2 fw-bold" style="display:flex; justify-content:center; font-size:18px;">
                            구매 정보
                        </div>
                        <hr class="w-100 p-0 m-0">
                        <div class="m-2 fw-bold" th:text="@{|강의 가격 : ${course.price} 포인트|}"></div>
                        <button class="btn" style="background-color: #0D6EFD; color:white;">구매하기</button>
                        <button class="btn">장바구니 넣기</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <h1 class="fw-bold">관련 강의</h1>
            <div class="vesitable">
                <div class="owl-carousel vegetable-carousel justify-content-center">

                    <a href="#">
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <img src="https://i.namu.wiki/i/30whaqjessttAI0WYfI4EUeLMpBsch-usaIxU4jd3GJlKj1WSMwTDR8CODkb7dGvhi4PNfYcawLB-scDXOl4QmsFMJpQMTtPhKXUy9DCBdg1_hgm38L9MbXVlRGqDi8KbOwkouNYVtX5NDvT9L3vbA.webp"
                                     class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                                 style="top: 10px; right: 10px;">
                                대장 강사
                            </div>
                            <div class="p-4 rounded-bottom">
                                <h4>신광식</h4>
                                <div>
                                    개발자 연구소장
                                </div>
                                <div>
                                    넷카라쿠배당 드가자~
                                </div>
                            </div>
                        </div>
                    </a>

                    <a href="#">
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <img src="https://i.namu.wiki/i/UpBemT9FWEQLTEy2mr1UOfdHKI5falKCBX5HTEAbmgayHHadrmDCk559aG8UeovO2P1NZPuJSuM31vpw1edOaN3fWzLBRfihJoudSPjSDPy6gpieLFfFNoO5CkSUrmZv-76S29qAdaptK9OvyRmQAA.webp"
                                     class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                                 style="top: 10px; right: 10px;">
                                우수 학생
                            </div>
                            <div class="p-4 rounded-bottom">
                                <h4>김두한</h4>
                                <div>
                                    개발자 연구소 반장
                                </div>
                                <div>
                                    넷카라쿠배당 드가자~
                                </div>
                            </div>
                        </div>
                    </a>

                    <a href="#">
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <img src="https://i.namu.wiki/i/RGkr0udf66wY1Qht4nAo6mBS0PRoDKzGMkfz7BSyZ1a6WCWSMizfXwvUzfYj6ty0WeIV-ZUeY_6T6ltPlkgVUdf1y86v3i5jEuSoepTrBMAuujn-U40ZnLezXGWRYgUFKkvYrMVH-9hVypVzEFkrHw.webp"
                                     class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                                 style="top: 10px; right: 10px;">
                                우수 학생
                            </div>
                            <div class="p-4 rounded-bottom">
                                <h4>김대호</h4>
                                <div>
                                    개발자 연구소 우수 학생
                                </div>
                                <div>
                                    넷카라쿠배당 드가자~
                                </div>
                            </div>
                        </div>
                    </a>

                    <a href="#">
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <img src="https://i.namu.wiki/i/NfoLir0aEVQURPb0RFGD1u-G2YVFOD-8SaLuPZuZ7PAeWIsPMGGlO_kS6575Qs_QKvs9gwtyi5cLjQURSdbVlnwA9XN_XYPyJ3QHt61iNwdvpmHFkWDU-huYsGbPA0Qe5pLMrzQIaNPu2PK-XRTelw.webp"
                                     class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                                 style="top: 10px; right: 10px;">
                                그냥 학생
                            </div>
                            <div class="p-4 rounded-bottom">
                                <h4>전오빈</h4>
                                <div>
                                    개발자 연구소 연구원
                                </div>
                                <div>
                                    넷카라쿠배당 드가자~
                                </div>
                            </div>
                        </div>
                    </a>

                    <a href="#">
                        <div class="border border-primary rounded position-relative vesitable-item">
                            <div class="vesitable-img">
                                <img src="https://i.namu.wiki/i/blVyIGCxGdHoC24pHBc_S92-_VizSaRvsFlfvCCR9YlheDcmbbZ45QRSLn1aKBgzexWUGFz7fa8qCyru6yCfA7Rdbbo9Z2ZxhzdoB9peLXlobdxP2-gfdcMHAB0xuUGfzrluOb6GQeUmu0vHblEaHQ.webp"
                                     class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                                 style="top: 10px; right: 10px;">
                                그냥 학생
                            </div>
                            <div class="p-4 rounded-bottom">
                                <h4>양희동</h4>
                                <div>
                                    개발자 연구소 연구원
                                </div>
                                <div>
                                    넷카라쿠배당 드가자~
                                </div>
                            </div>
                        </div>
                    </a>


                </div>
            </div>
        </div>


    </div>
    <script>
        $(function() {
            $('#postReview').on("click", function(){
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");

                $.ajax({
                     type : 'post',              // 타입 (get, post, put 등등)
                     url : '/review/create',     // 요청할 서버url
                     async : true,               // 비동기화 여부 (default : true)
                     beforeSend : function(xhr) {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
                         xhr.setRequestHeader(header, token);
                     },
                     headers : {                 // Http header
                         "Content-Type" : "application/json",
                         "X-HTTP-Method-Override" : "POST"
                     },
                     dataType : 'text',          // 데이터 타입 (html, xml, json, text 등등)
                     data : JSON.stringify({     // 보낼 데이터 (Object , String, Array)
                         "courseId" : [[${course.id}]],
                         "content" : $('#reviewContent').val().trim(),
                         "score" : $('.rating__star.fas.fa-star').length
                     }),
                     success : function(result) { // 결과 성공 콜백함수
                            $('#nav-review').load(window.location.href+' #nav-review');
                     },
                     error : function(request, status, error) { // 결과 에러 콜백함수
                             console.log(error);
                     }
                })
            });
        const ratingStars = [...document.getElementsByClassName("rating__star")];
        function executeRating(stars) {
            const starClassActive = "rating__star fas fa-star";
            const starClassUnactive = "rating__star far fa-star";
            const starsLength = stars.length;
            let i;
            stars.map((star) => {
                star.onclick = () => {

                    i = stars.indexOf(star);
                    if (star.className.indexOf(starClassUnactive) !== -1) {
                        for (i; i >= 0; --i) stars[i].className = starClassActive;
                    } else {
                        for (i; i < starsLength; ++i) stars[i].className = starClassUnactive;
                    }
                };
            });
        }

        executeRating(ratingStars);

        });
    </script>
</div>
</html>
