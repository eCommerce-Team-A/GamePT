<!doctype html>
<html lang="ko" style="height:100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Raleway:wght@600;800&display=swap"
          rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="/lib/lightbox/css/lightbox.min.css" rel="stylesheet">
    <link href="/lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <!--    <link href="/css/bootstrap.min.css" rel="stylesheet">-->

    <!-- Template Stylesheet -->
    <link href="/css/style.css" rel="stylesheet">

    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

</head>

<body style="height:100%;">

<!-- Spinner Start -->
<div id="spinner"
     class="show w-100 vh-100 bg-white position-fixed translate-middle top-50 start-50  d-flex align-items-center justify-content-center">
    <div class="spinner-grow text-primary" role="status"></div>
</div>
<!-- Spinner End -->

<div class="position-relative" style="height:100%;">
    <div class="position-absolute top-50 start-50 translate-middle">
        <div class="card">
            <div class="card-body">
                <div class="text-center my-5">
                    <a href="/" class="navbar-brand text-center"><img src="/img/GamePT.svg" style="width:250px; height:auto;" alt="logo" /></a>
                </div>

                <h4 class="card-title text-center">ID/PW 찾기</h4>
                <p class="card-text text-center mt-3">모든 게이머들을 위한 GamePT에 오신것을 환영합니다.</p>

                <div>
                    <div>
                        <h3>Find LoginId</h3>
                    </div>
                    <div class="form-floating mb-3 has-validation">
                        <input name="nickname" type="text" class="form-control" id="findUsernameNickname" placeholder="Nickname"  aria-describedby="inputGroupPrepend" required>
                        <label for="findUsernameNickname">Nickname</label>
                    </div>
                    <div class="form-floating has-validation">
                        <input name="email" type="email" class="form-control" id="findUsernameEmail" placeholder="Email" aria-describedby="inputGroupPrepend" required>
                        <label for="findUsernameEmail">Email</label>
                    </div>
                    <button class="btn btn-outline-primary mt-3 w-100 btn-find" id="findUsername">아이디 찾기</button>
                    <hr>
                    <div class="mt-3">
                        <h3>Find Password</h3>
                    </div>
                    <div class="form-floating mb-3 has-validation">
                        <input name="username" type="text" class="form-control" id="findPasswordUsername" placeholder="Login Id"  aria-describedby="inputGroupPrepend" required>
                        <label for="findPasswordUsername">Login Id</label>
                    </div>
                    <div class="form-floating has-validation">
                        <input name="email" type="email" class="form-control" id="findPasswordEmail" placeholder="Email" aria-describedby="inputGroupPrepend" required>
                        <label for="findPasswordEmail">Email</label>
                    </div>
                    <button class="btn btn-outline-primary mt-3 w-100 btn-find" id="findPassword">비밀번호 찾기</button>
                    <hr>
                    <div class="d-flex justify-content-between">
                        <a href="/user/login">로그인</a>
                        <a href="/user/signup">회원가입</a>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>




<!-- JavaScript Libraries -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/lib/easing/easing.min.js"></script>
<script src="/lib/waypoints/waypoints.min.js"></script>
<script src="/lib/lightbox/js/lightbox.min.js"></script>
<script src="/lib/owlcarousel/owl.carousel.min.js"></script>

<!-- Template Javascript -->
<script src="/js/main.js"></script>

<script>
    $(function() {



        $( ".btn-find" ).on( "click", function() {

            var type = $(this).attr("id");

            console.log(type);

            var username = "";
            var nickname = "";
            var email = "";

            if(type == "findUsername"){
                nickname = $("#findUsernameNickname").val().trim();
                email = $("#findUsernameEmail").val().trim();

                if(nickname == "" || email == ""){
                    alert("값을 입력하세요");
                    return;
                }

            }else if(type == "findPassword"){
                username = $("#findPasswordUsername").val().trim();
                email = $("#findPasswordEmail").val().trim();

                if(username == "" || email == ""){
                    alert("값을 입력하세요");
                    return;
                }

            }

            let regex = new RegExp('[a-z0-9]+@[a-z]+\.[a-z]{2,3}');

            if(!regex.test(email)){
                alert("이메일 형식이 아닙니다.");
                return;
            }

            var token = $("meta[name='_csrf']").attr("content");
		    var header = $("meta[name='_csrf_header']").attr("content");

            $.ajax({
                type : 'post',              // 타입 (get, post, put 등등)
                url : '/user/findUserInfo',     // 요청할 서버url
                async : true,               // 비동기화 여부 (default : true)
                beforeSend : function(xhr) {   /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
                    xhr.setRequestHeader(header, token);
                },
                headers : {                 // Http header
                    "Content-Type" : "application/json",
                    "X-HTTP-Method-Override" : "POST"
                },
                dataType : 'text',          // 데이터 타입 (html, xml, json, text 등등)
                data : JSON.stringify({ // 보낼 데이터 (Object , String, Array)
                    "type" : type,
                    "username" : username,
                    "email" : email,
                    "nickname" : nickname
                }),
                success : function(result) { // 결과 성공 콜백함수
                    let data = JSON.parse(result)
                    alert(data.message);
                  },
                error : function(request, status, error) { // 결과 에러 콜백함수
                        alert(error);
                }
            })

        } );

    });
</script>

</body>

</html>